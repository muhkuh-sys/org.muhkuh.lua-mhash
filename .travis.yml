language: c

env:
  global:
    - secure: Jf4NKmknTjdvCvhWQndTLQE4uVqK4Gl5akCs+Jhy/owYQv2O05nnfQdayhl0XtLD9vuzzRDZIMvAOGcJQxW0g+mYGUPUNPVKwcbItHoumaA5iut0eCRADXiMWukejKQpK1SGerMUSLyTl49dcCaM2mRMYxcyoVI6BVyW0Zmy76M=
    - PATH=/opt/mingw-w64-i686/bin:/opt/mingw-w64-x86_64/bin:${PATH}


before_install:
  - sudo dpkg --purge cmake cmake-doc cmake-data
  - curl http://download.opensuse.org/repositories/home:/doc_bacardi/xUbuntu_12.04/Release.key | sudo apt-key add -
  - echo "deb http://download.opensuse.org/repositories/home:/doc_bacardi/xUbuntu_12.04 ./" | sudo tee -a /etc/apt/sources.list
  - sudo apt-get update -qq
  - sudo apt-get --assume-yes install mingw-w64-mbs
  - sudo apt-get --assume-yes install gcc-multilib g++-multilib make libudev-dev libreadline6-dev
  - sudo apt-get --assume-yes install cmake3
  - sudo apt-get --assume-yes install p7zip
  - sudo apt-get --assume-yes install python-pip python-virtualenv
  - curl --output lua.zip https://github.com/muhkuh-sys/org.lua-lua/releases/download/v5.1.1/lua.zip
  - mkdir lua
  - 7z x -olua lua.zip
  - virtualenv ~/virtualenv/python2.7
  - source ~/virtualenv/python2.7/bin/activate
  - pip install -q requests


# This is the command to build the whole project and pack the results in a distributable form.
script:
  - ./.build.sh
  - python installer/ivy/deploy.py build/artifacts/artifacts_mhash.xml


deploy:
  provider: releases
  api_key:
    secure: mrw32k5aKAP2p/1RnkNGKa9Gc2Vu3bASqb3ryiCWNif22RLuCts2eMwTr2mPnc/umRVYyHqggPJf+BcPkvAgxgwo4paN7JwED35RMDSP+ghLEcPQyS7VEj5SrWqF9vYm9AZ6pw8aTqLvemgdcjMJa/jzJ/UtovLq79vJ+i+SqBw=
  file:
    - build/lua.zip
    - build/ivy.xml
  skip_cleanup: true
  on:
    repo: muhkuh-sys/org.muhkuh.lua-mhash
    tags: true
